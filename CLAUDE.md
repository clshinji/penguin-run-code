# CLAUDE.md

このファイルは、このリポジトリでコードを操作する際のClaude Code (claude.ai/code) への指針を提供します。

## プロジェクト概要

これは子供向けのペンギン横スクロールアクションゲームプロジェクトです。ゲームの特徴：
- HTML5 Canvas ベースの Phaser.js フレームワークを使用したウェブゲーム
- 子供に優しい直感的な操作デザイン
- ローカル保存・読み込み機能付きマルチユーザー対応
- デスクトップとモバイルデバイス対応のレスポンシブデザイン
- GitHub Pages デプロイ対応の Progressive Web App

## 主要実装機能

- **プレイヤーキャラクター**: 移動、ジャンプ、浮遊機能（カービィ風）を持つペンギン
- **ゲーム機構**: ライフシステム、衝突検出、敵AI、パワーアップ、隠し要素
- **音響システム**: 音量調整付きBGMと効果音
- **ユーザー管理**: 個別進行状況追跡付きマルチユーザープロファイル
- **実績システム**: 共有機能付きアンロック可能な実績
- **難易度設定**: 3段階の難易度（やさしい、ふつう、むずかしい）
- **デバッグモード**: テスト・ステージ選択用開発者ツール
- **バックアップ・復元**: JSON ベースのセーブデータエクスポート・インポート

## 開発環境

- **ランタイム**: Docker devcontainer 内の Node.js 20
- **IDE**: ESLint、Prettier、GitLens、Claude Code 拡張機能付き VSCode
- **シェル**: powerline テーマ付き Zsh
- **Git**: ユーザー "shinji" <clshinji@gmail.com> で設定済み

## プロジェクト構造

新規プロジェクトのため、予想される構造：

```
/workspace/
├── src/                          # ソースコード
│   ├── game/                     # コアゲームロジック
│   │   ├── Player.js            # プレイヤーキャラクター管理
│   │   ├── Enemy.js             # 敵AI・行動
│   │   ├── PowerUp.js           # パワーアップシステム
│   │   └── PhysicsEngine.js     # 衝突検出・物理演算
│   ├── managers/                 # システム管理
│   │   ├── AudioManager.js      # 音響・音楽管理
│   │   ├── UserManager.js       # ユーザープロファイル管理
│   │   ├── SaveSystem.js        # 保存・読み込み機能
│   │   └── AchievementManager.js # 実績システム
│   ├── scenes/                   # Phaser.js シーン
│   │   ├── MainMenuScene.js     # メインメニュー
│   │   ├── GameScene.js         # メインゲームプレイ
│   │   └── SettingsScene.js     # 設定画面
│   └── utils/                    # ユーティリティ関数
├── assets/                       # ゲームアセット
│   ├── images/                   # スプライト・背景
│   ├── audio/                    # 音楽・効果音
│   │   ├── bgm/                  # BGM
│   │   └── sfx/                  # 効果音
│   └── data/                     # ゲームデータファイル
├── tests/                        # テストファイル
├── dist/                         # デプロイ用ビルドファイル
├── index.html                    # メインHTMLファイル
├── package.json                  # NPM依存関係
└── README.md                     # プロジェクトドキュメント
```

## 技術スタック

- **ゲームエンジン**: Phaser.js（HTML5 Canvas フレームワーク）
- **言語**: JavaScript（ES6+）
- **ストレージ**: ユーザーデータ永続化用 LocalStorage
- **音響**: OGG/MP3 サポート付き Web Audio API
- **テスト**: 単体テスト用 Jest
- **ビルド**: バンドル・最適化用 Webpack
- **デプロイ**: GitHub Pages

## 主要開発コマンド

新規プロジェクトのため、これらのコマンドの設定が必要：

```bash
# プロジェクト初期化
npm init -y
npm install phaser jest webpack webpack-cli

# 開発
npm run dev          # 開発サーバー起動
npm run build        # 本番用ビルド
npm run test         # 単体テスト実行
npm run lint         # ESLint実行
npm run format       # Prettier実行

# デプロイ
npm run deploy       # GitHub Pages へデプロイ
```

## アーキテクチャ概要

ゲームは階層アーキテクチャに従います：

1. **プレゼンテーション層**: Phaser.js シーンとUI管理
2. **ゲームロジック層**: コアゲーム機構とルール
3. **データ管理層**: ユーザープロファイルと保存システム
4. **ストレージ層**: データ永続化用 LocalStorage

## 重要な実装注意事項

### 音響システム
- BGMと効果音を個別音量調整で分離
- OGG（メイン）とMP3（フォールバック）フォーマット対応
- シームレスなBGMループ実装
- 全音響ファイルは子供に優しく、怖くない内容

### ユーザー管理
- 複数ユーザープロファイル対応（3-12文字のユーザー名）
- 各ユーザーは個別の進行状況、実績、設定を持つ
- データはブラウザの LocalStorage にローカル保存
- JSON ベースのバックアップ・復元機能

### セキュリティ考慮事項
- 外部データ送信なし - 全データはローカル保持
- ユーザー名とファイルアップロードの入力検証
- XSS防止対策
- HTTPS専用デプロイ

### パフォーマンス要件
- ゲームプレイ中は30+FPS維持
- 3秒以下の読み込み時間
- レスポンシブな入力処理
- オブジェクトプールによる効率的メモリ管理

### 多言語対応
- 主言語：日本語
- UIテキストは容易にローカライズ可能
- 将来拡張のためのRTLテキスト対応を考慮

## テスト戦略

1. **単体テスト**: 個別クラス機能
2. **統合テスト**: コンポーネント間連携
3. **パフォーマンステスト**: フレームレートとメモリ使用量
4. **互換性テスト**: クロスブラウザ・デバイステスト
5. **ユーザーエクスペリエンステスト**: 子供に優しいインターフェース検証

## 開発ワークフロー

1. コアゲームループと基本プレイヤー移動から開始
2. 衝突検出と物理演算を実装
3. 敵AIとゲーム機構を追加
4. ユーザー管理と保存システムを開発
5. 音響とビジュアル仕上げを実装
6. 実績と共有システムを追加
7. パフォーマンスを最適化し、デバイス間テスト
8. GitHub Pages にデプロイ

## デバッグ機能

- **デバッグモード**: Ctrl+Shift+D で切り替え
- **ステージ選択**: テスト用任意ステージアクセス
- **デバッグ情報表示**: プレイヤー座標、FPS、メモリ使用量
- **衝突ボックス可視化**: ビジュアルデバッグ支援
- **個別デバッグ保存データ**: ユーザーデータ汚染防止

## モバイル考慮事項

- **タッチ操作**: 仮想十字キーとジャンプボタン
- **レスポンシブレイアウト**: 自動UI拡縮
- **パフォーマンス**: モバイルブラウザ最適化
- **タッチジェスチャー**: タップでジャンプ、長押しで浮遊

## 既知の制約

- **対象読者**: 子供（年齢に適したコンテンツのみ）
- **プラットフォーム**: ウェブブラウザのみ（ネイティブアプリなし）
- **オフライン対応**: 初回読み込み後はインターネットなしで動作
- **データプライバシー**: 外部データ収集・送信なし
- **ファイルサイズ**: 高速読み込みのため総ゲームサイズ50MB未満

## 開発のヒント

- `.kiro/specs/penguin-side-scroller/` の詳細な日本語仕様に従う
- `tasks.md` の包括的タスクリストを開発ロードマップとして使用
- テスト駆動開発（TDD）アプローチを実装
- デスクトップとモバイルデバイスでの定期的テスト
- 開発全体を通じて子供に優しいビジュアル・音響デザインを維持

## 要件仕様書の場所

- **要件書**: `.kiro/specs/penguin-side-scroller/requirements.md`
- **実装タスク**: `.kiro/specs/penguin-side-scroller/tasks.md`
- **デザイン文書**: `.kiro/specs/penguin-side-scroller/design.md`

これらのファイルには、ゲームの詳細な機能要件、受け入れ基準、アーキテクチャ設計が記載されています。